<template>
  <div id="inside_view">
    <div id="layer_div">
      <div id="layer_list">
        <div id="layer_title">Liste des couches</div>
        <div id="div_select_etat">
          <select v-on:load="change_etat($event)" v-on:change="change_etat($event)" id="select_etat">
            <option v-for="etat in etats" :key="etat">{{ etat }}</option>
          </select>
        </div>
        <div class="layer_line_descr" v-for="item in items">
          <div class="layer_name" :id=item.etat :key="item.message + item.etat"
            v-on:click="change_visibility(item.message, item.etat, $event)">
            {{ item.message }} {{ item.etat }}
          </div>
          <div class="layer_symbol"></div>
        </div>
        <div id="descr_utile">Cliquer sur le nom de la couche permet de l'activer ou la désactiver</div>
      </div>
    </div>
    <div id="ol-container" class="map">
    </div>
  </div>

</template>

<script>
import 'ol/ol.css';
import Map from 'ol/Map';
import WMTS from 'ol/source/WMTS';
import TileLayer from 'ol/layer/Tile';
import Image from 'ol/layer/Image';
import { ImageStatic } from 'ol/source';
import tilegrid from 'ol/tilegrid/WMTS';
import * as olProj from 'ol/proj/';
import { register } from 'ol/proj/proj4';
import proj4 from 'proj4';
import View from "ol/View"
import GeoJSON from 'ol/format/GeoJSON';
import { Vector as VectorSource } from 'ol/source';
import { Circle as CircleStyle, Fill, Stroke, Style, Text } from 'ol/style';
import { Vector as VectorLayer } from 'ol/layer';

//FUNCTION DE BASE
// ================================================================================
function create_vector(classi) {
  let Geojson = new GeoJSON().readFeatures(classi['geojson_layer']);
  var class_layer = classi
  let vectorlay = new VectorLayer({
    source: new VectorSource({
      features: Geojson
    }),
    style: function (feature) {
      let text_descr = feature.get('descr')
      if (feature.get('volume')) {
        text_descr += '\n' + feature.get('volume')
      };
      return new Style({
        stroke: new Stroke({
          color: class_layer['color'],
          lineDash: [class_layer['line']],
          width: class_layer['width_li']
        }),
        fill: new Fill({
          color: class_layer['color_fill']
        }),
        text: new Text({
          text: text_descr,
          placement: 'Point',
          font: '20px Calibri, Courier New',
          fill: new Fill({
            color: class_layer['color']
          }),
          stroke: new Stroke({
            color: 'white',
            width: 3
          })
        })
      })
    },
    visible: true
  });
  return vectorlay
}

function update_visibility(name_update, etat, layer_name, layer, layer_etat, target) {
  if (name_update == layer_name && etat == layer_etat) {
    if (layer.getVisible()) {
      layer.setVisible(false)
      target.style.color = "gray";
    } else {
      layer.setVisible(true)
      target.style.color = "black";
    }
  }
}

function update_visibility_etat(etat, layer, layer_etat, etat_choisi) {
  if (etat == layer_etat || layer_etat == '' || etat_choisi == 'Tous') {
    layer.setVisible(true)
  } else {
    layer.setVisible(false)
  }
}

function update_display_liste_couche(couche_html, etat) {
  if (couche_html.children[0].id == etat || couche_html.children[0].id == '' || etat == 'Tous') {
    couche_html.style.display = 'flex';
  } else {
    couche_html.style.display = 'none';
  }


}


//Projection Suisse MN95
proj4.defs("EPSG:2056", "+proj=somerc +lat_0=46.95240555555556 +lon_0=7.439583333333333 +k_0=1 +x_0=2600000 +y_0=1200000 +ellps=bessel +towgs84=674.374,15.056,405.346,0,0,0,0 +units=m +no_defs");

register(proj4)

//Constante pour le WMST Cadastre
const resolutions = [
  4000, 3750, 3500, 3250, 3000, 2750, 2500, 2250, 2000, 1750, 1500, 1250,
  1000, 750, 650, 500, 250, 100, 50, 20, 10, 5, 2.5, 2, 1.5, 1, 0.5
];

const extent = [2420000, 130000, 2900000, 1350000];
const projection = olProj.get('EPSG:2056');
projection.setExtent(extent);

const matrixIds = [];
for (var i = 0; i < resolutions.length; i++) {
  matrixIds.push(i);
}

// LAYER de la carte
// ================================================================================
//Création d'un WMTS cadastre vaud
const wmtsCadastre = new TileLayer({
  source: new WMTS(({
    layer: 'asitvd.fond_cadastral',
    crossOrigin: 'anonymous',
    url: '//wmts.asit-asso.ch/wmts/1.0.0/{Layer}/default/default/0/2056/{TileMatrix}/{TileRow}/{TileCol}.png',
    tileGrid: new tilegrid({
      origin: [extent[0], extent[3]],
      resolutions: resolutions,
      matrixIds: matrixIds
    }),
    requestEncoding: 'REST'
  })),
  visible: true
});

//Orthophoto_static
const extentstatic = [2520648.872, 1155705.593, 2521725.060, 1156365.733];

const staticimage = new Image({
  source: new ImageStatic({
    url: "ortho_lowlow.png",
    projection: projection,
    crossOrigin: '',
    interpolate: true,
    imageExtent: extentstatic
  })
});

const extentstatic_2020 = [2520648.921, 1155705.527, 2521725.145, 1156365.682];

const staticimage_2020 = new Image({
  source: new ImageStatic({
    url: "ortho_2020-11.png",
    projection: projection,
    crossOrigin: '',
    interpolate: true,
    imageExtent: extentstatic_2020
  })
});


//LECTEUR DE DONNEES VECTORIEL
// ================================================================================
//CASIER
const json_casier = {
  "type": "FeatureCollection",
  "name": "casier",
  "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:EPSG::2056" } },
  "features": [
    { "type": "Feature", "properties": { "descr": "C3" }, "geometry": { "type": "MultiPolygon", "coordinates": [[[[2521016.974, 1156135.699], [2521226.969, 1156095.808999999891967], [2521292.58600000012666, 1156205.504999999888241], [2521198.816000000108033, 1156232.686], [2521157.33, 1156247.476], [2521131.069999999832362, 1156266.95], [2521057.916999999899417, 1156171.774], [2521041.27, 1156154.069], [2521016.974, 1156135.699]]]] } },
    { "type": "Feature", "properties": { "descr": "C5" }, "geometry": { "type": "MultiPolygon", "coordinates": [[[[2520955.12099999981001, 1155973.504], [2520916.546999999787658, 1156023.439], [2520903.085, 1156001.821], [2520879.390000000130385, 1155830.965], [2521100.469, 1155797.449], [2521111.203000000212342, 1155814.038], [2521117.600999999791384, 1155826.834], [2521132.859000000171363, 1155838.571], [2521137.055000000167638, 1155838.571], [2521148.832, 1155836.216], [2521168.068, 1155819.602], [2521180.291000000201166, 1155833.571], [2521250.890999999828637, 1155833.571], [2521277.56900000013411, 1155840.847], [2521249.933000000193715, 1155809.96], [2521237.866, 1155776.543], [2521267.824, 1155771.984], [2521312.443, 1155801.203], [2521276.151, 1155845.638], [2521235.733, 1155887.605], [2521201.032000000122935, 1155920.862], [2521156.591, 1155950.928], [2521144.364, 1155957.712], [2521027.842999999877065, 1155969.489], [2520958.347, 1155971.302], [2520955.12099999981001, 1155973.504]]]] } },
    { "type": "Feature", "properties": { "descr": "C4" }, "geometry": { "type": "MultiPolygon", "coordinates": [[[[2520916.546999999787658, 1156023.439], [2520995.211999999824911, 1156149.773], [2521016.974, 1156135.699], [2521226.969, 1156095.808999999891967], [2521144.364, 1155957.712], [2521027.842999999877065, 1155969.489], [2520958.347, 1155971.302], [2520955.12099999981001, 1155973.504], [2520916.546999999787658, 1156023.439]]]] } },
    { "type": "Feature", "properties": { "descr": "C1" }, "geometry": { "type": "MultiPolygon", "coordinates": [[[[2521144.364, 1155957.712], [2521156.591, 1155950.928], [2521201.032000000122935, 1155920.862], [2521235.733, 1155887.605], [2521276.151, 1155845.638], [2521312.443, 1155801.203], [2521480.376000000163913, 1155911.177], [2521484.08, 1155913.92], [2521487.443, 1155917.07], [2521490.421999999787658, 1155920.587], [2521492.977, 1155924.422], [2521495.072999999858439, 1155928.526], [2521226.969, 1156095.808999999891967], [2521144.364, 1155957.712]]]] } },
    { "type": "Feature", "properties": { "descr": "C2" }, "geometry": { "type": "MultiPolygon", "coordinates": [[[[2521226.969, 1156095.808999999891967], [2521495.072999999858439, 1155928.526], [2521496.683999999891967, 1155932.844], [2521497.787, 1155937.319], [2521498.367999999783933, 1155941.891], [2521498.42, 1155946.499], [2521497.941000000108033, 1155951.082], [2521475.163000000175089, 1156090.675], [2521463.741, 1156160.673], [2521444.207, 1156163.074], [2521434.404, 1156164.895], [2521352.024000000208616, 1156188.446], [2521349.78899999987334, 1156188.923], [2521292.58600000012666, 1156205.504999999888241], [2521226.969, 1156095.808999999891967]]]] } }
  ]
};

const json_perimetre = {
  "type": "FeatureCollection",
  "name": "perimetre",
  "features": [
    { "type": "Feature", "properties": {}, "geometry": { "type": "MultiLineString", "coordinates": [[[2521100.469, 1155797.449], [2521104.370000000111759, 1155803.3], [2521111.203000000212342, 1155814.038], [2521117.600999999791384, 1155826.834], [2521132.859000000171363, 1155838.571], [2521137.055000000167638, 1155838.571], [2521148.832, 1155836.216], [2521168.068, 1155819.602], [2521180.291000000201166, 1155833.571], [2521185.56, 1155833.571], [2521232.56, 1155833.571], [2521250.890999999828637, 1155833.571], [2521277.56900000013411, 1155840.847], [2521249.933000000193715, 1155809.96], [2521237.866, 1155776.543], [2521267.824, 1155771.984], [2521341.744, 1155820.392], [2521442.048, 1155886.077], [2521480.376000000163913, 1155911.177], [2521484.08, 1155913.92], [2521487.443, 1155917.07], [2521490.421999999787658, 1155920.587], [2521492.977, 1155924.422], [2521495.072999999858439, 1155928.526], [2521496.683999999891967, 1155932.844], [2521497.787, 1155937.319], [2521498.367999999783933, 1155941.891], [2521498.42, 1155946.499], [2521497.941000000108033, 1155951.082], [2521463.741, 1156160.673], [2521444.207, 1156163.074], [2521434.404, 1156164.895], [2521352.024000000208616, 1156188.446], [2521349.78899999987334, 1156188.923], [2521198.816000000108033, 1156232.686], [2521157.33, 1156247.476], [2521131.069999999832362, 1156266.95], [2521057.916999999899417, 1156171.774], [2521041.27, 1156154.069], [2521016.974, 1156135.699], [2520995.211999999824911, 1156149.773], [2520903.085, 1156001.821], [2520879.390000000130385, 1155830.965], [2521089.881, 1155799.057], [2521100.469, 1155797.449]]] } }
  ]
};

const json_secteur_cubage_2022 = {
  "type": "FeatureCollection",
  "name": "secteur_cubage_2022",
  "color": 'blue',
  "features": [
    { "type": "Feature", "properties": { "id": "secteur_cubage", "descr": "B", "volume": "76'150m³" }, "geometry": { "type": "MultiPolygon", "coordinates": [[[[2521206.38799999980256, 1156185.192], [2521207.679, 1156183.187], [2521209.818, 1156180.948], [2521207.034, 1156177.227], [2521205.251000000163913, 1156170.219], [2521205.73, 1156166.313], [2521209.633, 1156160.435], [2521216.01299999980256, 1156153.594], [2521218.552000000141561, 1156148.945], [2521217.432, 1156142.858], [2521218.515999999828637, 1156139.104], [2521219.884999999776483, 1156136.546], [2521221.87900000018999, 1156133.571], [2521221.450999999884516, 1156131.04], [2521220.524000000208616, 1156127.751], [2521220.83600000012666, 1156121.796], [2521221.987999999895692, 1156119.29], [2521220.731000000145286, 1156115.333000000100583], [2521216.508, 1156116.129], [2521210.344, 1156118.729], [2521202.620000000111759, 1156123.502], [2521198.503, 1156126.904], [2521196.998000000137836, 1156129.213], [2521194.702, 1156133.446], [2521194.171, 1156134.767], [2521192.075999999884516, 1156139.986], [2521200.029999999795109, 1156140.949], [2521204.026, 1156141.663], [2521205.798, 1156143.275], [2521206.339000000152737, 1156146.609], [2521208.12900000018999, 1156153.384], [2521190.842000000178814, 1156165.187], [2521189.677000000141561, 1156164.023], [2521183.79, 1156160.594], [2521170.656, 1156157.036], [2521165.424999999813735, 1156156.783], [2521158.183999999891967, 1156160.427], [2521147.984999999869615, 1156164.200999999884516], [2521141.072000000160187, 1156164.829], [2521130.484000000171363, 1156165.562], [2521123.617, 1156168.393], [2521114.958999999798834, 1156173.661], [2521110.94, 1156177.723], [2521109.498999999836087, 1156181.129999999888241], [2521104.140000000130385, 1156183.587], [2521099.54, 1156187.486], [2521098.265000000130385, 1156196.365], [2521117.503, 1156221.091], [2521121.452, 1156227.862999999895692], [2521144.395, 1156252.057], [2521166.183999999891967, 1156241.683], [2521172.583999999798834, 1156239.627], [2521196.06, 1156231.916], [2521226.992, 1156222.482], [2521229.683000000193715, 1156213.28], [2521228.87900000018999, 1156210.541999999899417], [2521221.194999999832362, 1156210.855], [2521220.285000000149012, 1156209.865], [2521216.640000000130385, 1156206.852999999886379], [2521211.449, 1156205.418], [2521208.824, 1156201.561], [2521206.296999999787658, 1156195.948], [2521206.475, 1156190.706], [2521207.148, 1156186.924000000115484], [2521206.38799999980256, 1156185.192]]]] } },
    { "type": "Feature", "properties": { "id": "secteur_cubage", "descr": "A", "volume": "53'700m³" }, "geometry": { "type": "MultiPolygon", "coordinates": [[[[2521245.981999999843538, 1156068.382], [2521245.983, 1156068.383], [2521246.433999999891967, 1156068.754], [2521246.433999999891967, 1156068.754], [2521246.43099999986589, 1156068.767], [2521246.429, 1156068.779], [2521246.429, 1156068.779], [2521246.367, 1156069.077], [2521246.367, 1156069.077], [2521246.271999999880791, 1156069.538], [2521246.271999999880791, 1156069.538], [2521246.271999999880791, 1156069.538], [2521246.267, 1156069.561], [2521246.262000000104308, 1156069.585], [2521246.066000000108033, 1156070.535], [2521246.066000000108033, 1156070.535], [2521246.06, 1156070.563], [2521245.842999999877065, 1156071.611], [2521245.842999999877065, 1156071.611], [2521245.740000000223517, 1156072.108], [2521245.740000000223517, 1156072.108], [2521245.56, 1156072.981], [2521245.56, 1156072.981], [2521245.54, 1156073.027], [2521245.509999999776483, 1156073.097], [2521245.509999999776483, 1156073.097], [2521245.315, 1156073.549000000115484], [2521245.23700000019744, 1156073.731], [2521245.23700000019744, 1156073.731], [2521245.23700000019744, 1156073.731], [2521245.23700000019744, 1156073.731], [2521245.057, 1156074.148], [2521244.943, 1156074.414000000106171], [2521244.943, 1156074.414000000106171], [2521244.881, 1156074.557], [2521244.867, 1156074.591], [2521244.867, 1156074.591], [2521244.867, 1156074.591], [2521244.767, 1156074.822], [2521244.767, 1156074.822], [2521244.714999999850988, 1156074.944], [2521244.714999999850988, 1156074.944], [2521244.714999999850988, 1156074.944], [2521244.642, 1156075.112999999895692], [2521244.642, 1156075.112999999895692], [2521244.429, 1156075.607], [2521244.173, 1156076.202], [2521244.173, 1156076.202], [2521244.173, 1156076.202], [2521244.132000000216067, 1156076.297], [2521244.132000000216067, 1156076.297], [2521244.080999999772757, 1156076.633], [2521244.075999999884516, 1156076.666999999899417], [2521244.075999999884516, 1156076.666999999899417], [2521244.075999999884516, 1156076.666999999899417], [2521244.075999999884516, 1156076.67], [2521244.075999999884516, 1156076.67], [2521243.932, 1156077.616], [2521243.932, 1156077.617], [2521243.932, 1156077.617], [2521243.893000000156462, 1156077.871], [2521243.892, 1156077.879999999888241], [2521243.892, 1156077.879999999888241], [2521243.682, 1156079.264999999897555], [2521243.682, 1156079.264999999897555], [2521243.682, 1156079.264999999897555], [2521243.572000000160187, 1156079.986], [2521243.572000000160187, 1156079.986], [2521243.541000000201166, 1156080.193], [2521243.514, 1156080.370000000111759], [2521243.514, 1156080.370000000111759], [2521243.471, 1156080.651], [2521243.471, 1156080.651], [2521243.471, 1156080.651], [2521243.387000000104308, 1156081.207], [2521243.387000000104308, 1156081.207], [2521243.33, 1156081.58], [2521243.33, 1156081.58], [2521243.33, 1156081.58], [2521243.154999999795109, 1156082.737999999895692], [2521243.154, 1156082.743], [2521243.134, 1156082.876], [2521243.134, 1156082.876], [2521243.116, 1156082.991], [2521243.116, 1156082.991], [2521243.085, 1156083.199], [2521243.051, 1156083.424000000115484], [2521243.051, 1156083.424000000115484], [2521243.051, 1156083.424000000115484], [2521243.034, 1156083.534], [2521243.011, 1156083.683], [2521243.011, 1156083.683], [2521243.011, 1156083.683], [2521242.865000000223517, 1156084.649], [2521242.824, 1156084.919], [2521242.824, 1156084.919], [2521242.765999999828637, 1156085.297], [2521242.765999999828637, 1156085.297], [2521242.757000000216067, 1156085.361], [2521242.757000000216067, 1156085.361], [2521242.757000000216067, 1156085.361], [2521242.739, 1156085.477], [2521242.739, 1156085.477], [2521242.656, 1156086.021], [2521244.43099999986589, 1156084.914000000106171], [2521246.775, 1156083.450999999884516], [2521249.072999999858439, 1156082.018], [2521250.813, 1156080.932], [2521252.541000000201166, 1156079.854], [2521252.541000000201166, 1156079.854], [2521252.975, 1156079.583000000100583], [2521252.975, 1156079.583000000100583], [2521253.023, 1156079.553], [2521253.043, 1156079.541], [2521253.043, 1156079.541], [2521253.256, 1156079.408], [2521253.75, 1156079.099], [2521253.75, 1156079.099], [2521253.75, 1156079.099], [2521254.092999999877065, 1156078.886], [2521254.395, 1156078.697], [2521254.395, 1156078.697], [2521254.395, 1156078.697], [2521254.395, 1156078.697], [2521254.855, 1156078.41], [2521254.855, 1156078.41], [2521254.964999999850988, 1156078.341], [2521255.078000000212342, 1156078.271], [2521255.078000000212342, 1156078.271], [2521255.947999999858439, 1156077.727999999886379], [2521255.947999999858439, 1156077.727999999886379], [2521255.947999999858439, 1156077.727999999886379], [2521256.498999999836087, 1156077.384], [2521256.498999999836087, 1156077.384], [2521256.509, 1156077.378], [2521256.53899999987334, 1156077.359], [2521256.53899999987334, 1156077.359], [2521256.579, 1156077.334], [2521256.585, 1156077.33], [2521256.585, 1156077.33], [2521256.702, 1156077.258], [2521256.702, 1156077.258], [2521259.004999999888241, 1156075.82], [2521260.687, 1156073.077], [2521261.311000000219792, 1156069.587], [2521262.619, 1156068.704], [2521263.298, 1156067.104], [2521264.389, 1156066.028], [2521264.649000000208616, 1156063.656], [2521265.176, 1156062.33], [2521265.904, 1156060.992], [2521267.105, 1156060.739], [2521266.75, 1156060.075999999884516], [2521267.62099999981001, 1156059.41], [2521267.649000000208616, 1156058.541999999899417], [2521269.526, 1156056.031999999890104], [2521270.244, 1156054.562], [2521271.325999999884516, 1156053.549000000115484], [2521272.821, 1156052.614], [2521273.696, 1156051.612999999895692], [2521273.791999999899417, 1156050.625], [2521274.683000000193715, 1156048.666], [2521275.383, 1156046.797], [2521275.694999999832362, 1156045.9], [2521276.197999999858439, 1156045.137000000104308], [2521276.112999999895692, 1156044.450999999884516], [2521276.571, 1156043.284], [2521277.228999999817461, 1156042.620000000111759], [2521278.02, 1156042.421], [2521278.491, 1156041.013], [2521278.907999999821186, 1156040.033], [2521279.143999999854714, 1156038.426], [2521279.748000000137836, 1156038.048], [2521279.458000000100583, 1156037.745000000111759], [2521280.949, 1156035.999], [2521281.389, 1156034.492], [2521281.94400000013411, 1156032.924000000115484], [2521283.265999999828637, 1156030.481], [2521283.224, 1156028.942], [2521283.759, 1156027.57], [2521284.811000000219792, 1156026.682], [2521284.511, 1156025.862], [2521283.949, 1156024.713], [2521283.845000000204891, 1156024.293], [2521281.481000000145286, 1156022.281999999890104], [2521282.156, 1156021.007], [2521281.240000000223517, 1156020.727999999886379], [2521280.191000000108033, 1156020.783], [2521279.382000000216067, 1156019.932], [2521279.1, 1156017.82], [2521278.216, 1156017.620000000111759], [2521277.546999999787658, 1156017.469], [2521276.785999999847263, 1156017.298], [2521276.174000000115484, 1156017.075], [2521275.526999999769032, 1156016.84], [2521274.861, 1156016.598], [2521274.208000000100583, 1156016.360000000102445], [2521274.162, 1156016.344], [2521267.978000000119209, 1156015.237], [2521267.176, 1156014.756], [2521266.606999999843538, 1156014.414000000106171], [2521266.356000000145286, 1156014.264], [2521265.796, 1156013.957], [2521265.204, 1156013.633], [2521264.419000000227243, 1156013.144], [2521263.657999999821186, 1156012.656999999890104], [2521263.072999999858439, 1156012.284], [2521261.75400000018999, 1156011.158], [2521261.302999999839813, 1156010.541999999899417], [2521260.816000000108033, 1156009.878], [2521260.694999999832362, 1156008.79], [2521260.687, 1156008.409], [2521260.895, 1156007.197], [2521261.115000000223517, 1156005.919], [2521261.298, 1156004.858], [2521261.347, 1156004.575999999884516], [2521261.941999999806285, 1156002.523], [2521263.731999999843538, 1155999.737999999895692], [2521264.791999999899417, 1155998.562], [2521265.085, 1155998.289000000106171], [2521265.824, 1155997.700999999884516], [2521268.308000000193715, 1155997.346], [2521269.829, 1155995.254], [2521270.683000000193715, 1155994.17], [2521270.294000000227243, 1155993.105], [2521269.853000000119209, 1155991.896], [2521269.649000000208616, 1155991.338], [2521269.137000000104308, 1155991.003], [2521268.555000000167638, 1155990.622], [2521267.534, 1155989.955], [2521267.366, 1155989.845], [2521265.387000000104308, 1155990.016], [2521261.514, 1155989.011], [2521260.583999999798834, 1155987.921], [2521260.509999999776483, 1155987.835], [2521260.018000000156462, 1155987.258], [2521260.188999999780208, 1155986.401], [2521260.308000000193715, 1155985.806], [2521259.744, 1155985.139999999897555], [2521258.88799999980256, 1155984.131], [2521258.771999999880791, 1155983.995000000111759], [2521257.933999999891967, 1155983.007], [2521257.103999999817461, 1155982.029], [2521257.024000000208616, 1155981.933999999891967], [2521256.222, 1155980.987999999895692], [2521255.430000000167638, 1155980.055], [2521254.711999999824911, 1155978.991], [2521253.077, 1155974.84], [2521252.801, 1155972.993], [2521252.773, 1155972.806], [2521252.589999999850988, 1155971.58], [2521252.384, 1155970.724], [2521253.347, 1155963.477], [2521254.373000000137836, 1155961.628], [2521254.578000000212342, 1155960.351], [2521254.707, 1155959.541], [2521255.132000000216067, 1155956.891], [2521255.279, 1155955.969], [2521255.427000000141561, 1155955.047], [2521256.717999999877065, 1155951.286], [2521258.058999999891967, 1155948.984], [2521258.123999999836087, 1155948.898], [2521259.12099999981001, 1155947.568], [2521260.103999999817461, 1155946.257], [2521260.140000000130385, 1155946.183999999891967], [2521261.032000000122935, 1155944.364], [2521261.688, 1155943.026], [2521262.538000000175089, 1155941.535], [2521263.63799999980256, 1155940.147000000113621], [2521264.725999999791384, 1155938.774], [2521265.643000000156462, 1155937.617], [2521266.325999999884516, 1155936.754999999888241], [2521266.257000000216067, 1155936.308999999891967], [2521266.108, 1155935.342], [2521266.032999999821186, 1155934.288], [2521265.839000000152737, 1155934.089], [2521264.759, 1155932.983], [2521264.003, 1155932.21], [2521263.924000000115484, 1155932.125], [2521262.808000000193715, 1155930.199], [2521261.847, 1155929.859], [2521261.984999999869615, 1155929.013], [2521261.583000000100583, 1155928.945], [2521260.046999999787658, 1155928.379999999888241], [2521258.099, 1155926.987], [2521257.065, 1155927.098], [2521255.419000000227243, 1155928.199], [2521254.166999999899417, 1155926.596], [2521254.166999999899417, 1155926.596], [2521254.166999999899417, 1155926.596], [2521253.660000000149012, 1155926.903], [2521253.393000000156462, 1155927.065], [2521253.393000000156462, 1155927.065], [2521253.393000000156462, 1155927.065], [2521253.370000000111759, 1155927.064], [2521253.358, 1155927.064], [2521253.358, 1155927.064], [2521253.032000000122935, 1155927.056], [2521252.946, 1155927.054], [2521252.946, 1155927.054], [2521252.526999999769032, 1155927.043], [2521252.526999999769032, 1155927.043], [2521251.458000000100583, 1155927.017], [2521251.458000000100583, 1155927.017], [2521251.458000000100583, 1155927.017], [2521251.207, 1155927.011], [2521251.001000000163913, 1155927.006], [2521251.001000000163913, 1155927.006], [2521251.001000000163913, 1155927.006], [2521250.862999999895692, 1155927.002], [2521250.700000000186265, 1155926.998], [2521250.700000000186265, 1155926.998], [2521250.700000000186265, 1155926.998], [2521250.054, 1155926.982], [2521250.029999999795109, 1155926.982], [2521250.029999999795109, 1155926.982], [2521249.992, 1155926.981], [2521249.896999999880791, 1155926.977999999886379], [2521249.864, 1155926.977], [2521249.632000000216067, 1155926.972], [2521249.632000000216067, 1155926.972], [2521249.583000000100583, 1155926.971], [2521249.509999999776483, 1155926.969], [2521249.509999999776483, 1155926.969], [2521249.072000000160187, 1155926.715], [2521249.054, 1155926.705], [2521249.003, 1155926.676], [2521249.003, 1155926.676], [2521248.275, 1155926.254999999888241], [2521248.275, 1155926.254], [2521248.275, 1155926.254], [2521248.063, 1155926.132], [2521248.003, 1155926.098], [2521248.003, 1155926.098], [2521247.571, 1155925.847], [2521246.671999999787658, 1155925.327], [2521246.671999999787658, 1155925.327], [2521246.183999999891967, 1155925.045], [2521245.609999999869615, 1155924.713], [2521245.609999999869615, 1155924.713], [2521245.529999999795109, 1155924.666999999899417], [2521245.21, 1155924.381], [2521245.21, 1155924.381], [2521245.126000000163913, 1155924.306], [2521245.007000000216067, 1155924.199], [2521244.765999999828637, 1155923.983], [2521244.765999999828637, 1155923.983], [2521244.278, 1155923.546], [2521244.276999999769032, 1155923.546], [2521244.276999999769032, 1155923.546], [2521244.072000000160187, 1155923.362], [2521243.784, 1155923.104], [2521243.784, 1155923.104], [2521243.784, 1155923.104], [2521243.278, 1155922.652], [2521243.126999999862164, 1155922.516], [2521243.126999999862164, 1155922.516], [2521242.018999999854714, 1155921.525], [2521242.018999999854714, 1155921.525], [2521242.018999999854714, 1155921.525], [2521241.416999999899417, 1155920.986], [2521240.893000000156462, 1155920.517], [2521240.893000000156462, 1155920.517], [2521240.88799999980256, 1155920.512000000104308], [2521240.884, 1155920.508], [2521240.884, 1155920.508], [2521239.938999999780208, 1155919.663], [2521239.930000000167638, 1155919.654], [2521239.896999999880791, 1155919.625], [2521239.896999999880791, 1155919.625], [2521239.074, 1155918.888], [2521239.074, 1155918.888], [2521239.074, 1155918.888], [2521239.074, 1155918.888], [2521237.359000000171363, 1155917.352999999886379], [2521236.54, 1155916.620000000111759], [2521236.54, 1155916.620000000111759], [2521236.54, 1155916.620000000111759], [2521235.274000000208616, 1155915.487], [2521234.989, 1155915.232], [2521234.889, 1155915.142], [2521234.640999999828637, 1155914.92], [2521234.640999999828637, 1155914.92], [2521234.203000000212342, 1155914.529], [2521234.203000000212342, 1155914.529], [2521233.222, 1155913.65], [2521233.222, 1155913.65], [2521233.132000000216067, 1155913.57], [2521233.132000000216067, 1155913.57], [2521232.827, 1155913.297], [2521232.821, 1155913.291], [2521232.325999999884516, 1155913.436], [2521221.413000000175089, 1155916.619], [2521215.029, 1155918.48], [2521214.673, 1155918.584], [2521214.67, 1155918.585999999893829], [2521214.651999999769032, 1155918.596], [2521213.751000000163913, 1155919.133], [2521209.416999999899417, 1155921.713], [2521201.974, 1155926.143], [2521184.454, 1155936.57], [2521160.274000000208616, 1155950.960999999893829], [2521245.981999999843538, 1156068.382]]]] } }
  ]
}

const json_secteur_cubage_2020 = {
  "type": "FeatureCollection",
  "name": "secteur_cubage_2020",
  "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:EPSG::2056" } },
  "features": [
    { "type": "Feature", "properties": { "descr": "A" }, "geometry": { "type": "MultiPolygon", "coordinates": [[[[2521244.132000000216067, 1156076.297], [2521242.656, 1156086.021], [2521278.048, 1156063.939], [2521278.424000000115484, 1156061.59], [2521277.947000000160187, 1156059.127], [2521283.202, 1156052.791], [2521284.17, 1156048.548], [2521285.808000000193715, 1156045.136], [2521287.723000000230968, 1156043.264999999897555], [2521293.094, 1156037.543], [2521309.21, 1156027.163], [2521311.494, 1156007.793], [2521312.248999999836087, 1155987.009], [2521304.183999999891967, 1155954.674000000115484], [2521283.21100000012666, 1155929.379], [2521266.204, 1155921.597], [2521259.339000000152737, 1155923.469], [2521253.393000000156462, 1155927.065], [2521249.509999999776483, 1155926.969], [2521245.529999999795109, 1155924.666999999899417], [2521232.821, 1155913.291], [2521214.673, 1155918.584], [2521156.481999999843538, 1155953.218000000109896], [2521155.102, 1155954.49], [2521178.117, 1155990.93], [2521204.392, 1156025.26], [2521227.933999999891967, 1156052.734], [2521237.668, 1156061.557], [2521246.433999999891967, 1156068.754], [2521245.56, 1156072.981], [2521244.132000000216067, 1156076.297]]]] } },
    { "type": "Feature", "properties": { "descr": "B" }, "geometry": { "type": "MultiPolygon", "coordinates": [[[[2521217.742, 1156214.756], [2521218.455999999772757, 1156215.102], [2521220.484000000171363, 1156214.875], [2521222.199, 1156214.858], [2521225.029, 1156214.700999999884516], [2521226.617, 1156214.124], [2521234.549000000115484, 1156211.94], [2521238.325000000186265, 1156210.976], [2521240.929, 1156210.546], [2521257.055000000167638, 1156209.631], [2521267.984999999869615, 1156206.331], [2521272.393999999854714, 1156205.999], [2521275.811000000219792, 1156205.492], [2521282.007000000216067, 1156200.846], [2521289.747, 1156193.578], [2521299.276, 1156188.026], [2521308.704, 1156185.293], [2521306.381, 1156180.071], [2521304.294000000227243, 1156180.563], [2521301.603999999817461, 1156180.08], [2521298.640000000130385, 1156179.373], [2521296.074, 1156177.857], [2521294.893000000156462, 1156175.963], [2521292.727, 1156174.038], [2521291.241, 1156173.533], [2521288.835, 1156174.19], [2521286.183999999891967, 1156174.634], [2521283.883, 1156174.439], [2521279.115000000223517, 1156173.191000000108033], [2521270.313999999780208, 1156169.202], [2521266.467000000178814, 1156167.379999999888241], [2521263.23, 1156164.724], [2521258.991, 1156159.32], [2521257.318, 1156155.321], [2521256.632000000216067, 1156150.766], [2521257.588, 1156145.599], [2521258.554, 1156142.389999999897555], [2521259.93099999986589, 1156139.022000000113621], [2521261.404, 1156136.611], [2521260.717999999877065, 1156135.943], [2521255.222, 1156128.318], [2521253.259999999776483, 1156126.016], [2521251.731999999843538, 1156120.812], [2521251.453000000212342, 1156112.616], [2521252.537, 1156110.319], [2521255.666999999899417, 1156104.950999999884516], [2521260.776999999769032, 1156101.531999999890104], [2521264.498999999836087, 1156100.609], [2521266.946, 1156100.582], [2521266.096, 1156097.425], [2521265.63799999980256, 1156095.025], [2521267.119, 1156094.775], [2521267.883, 1156093.444], [2521269.470000000204891, 1156088.381], [2521271.501000000163913, 1156082.946], [2521273.327, 1156080.044], [2521275.234999999869615, 1156079.902], [2521276.811000000219792, 1156078.069], [2521277.007000000216067, 1156071.539000000106171], [2521278.048, 1156063.939], [2521274.151, 1156066.448], [2521274.143999999854714, 1156066.375], [2521242.656, 1156086.021], [2521240.727, 1156092.3], [2521239.187, 1156095.639999999897555], [2521237.964000000152737, 1156097.044], [2521236.875, 1156099.348], [2521235.663000000175089, 1156103.414000000106171], [2521232.4, 1156107.155], [2521230.477, 1156109.031999999890104], [2521228.705, 1156110.394], [2521226.80599999986589, 1156112.916], [2521225.088, 1156114.487], [2521223.319999999832362, 1156115.605], [2521220.791000000201166, 1156117.831], [2521219.105, 1156118.535], [2521218.063999999780208, 1156119.59], [2521217.364, 1156121.697], [2521216.642, 1156124.958000000100583], [2521216.129999999888241, 1156127.067], [2521215.092999999877065, 1156132.102], [2521214.707, 1156133.979], [2521213.881, 1156136.827], [2521213.156, 1156139.431], [2521212.858, 1156141.357], [2521212.572000000160187, 1156143.209], [2521212.055000000167638, 1156145.583000000100583], [2521211.554, 1156147.273], [2521210.98700000019744, 1156148.912], [2521209.720000000204891, 1156151.17], [2521208.008, 1156153.237999999895692], [2521205.87900000018999, 1156155.572], [2521204.781, 1156156.49], [2521201.160000000149012, 1156158.916999999899417], [2521202.974, 1156161.127], [2521203.06, 1156163.262000000104308], [2521203.438999999780208, 1156165.099], [2521203.173, 1156167.168], [2521202.841, 1156168.014], [2521203.274000000208616, 1156172.764], [2521203.799000000115484, 1156175.512000000104308], [2521204.276, 1156177.76], [2521205.01299999980256, 1156179.055], [2521205.643000000156462, 1156179.82], [2521204.193, 1156181.692], [2521202.872, 1156183.746], [2521202.37099999981001, 1156184.953], [2521202.068, 1156186.126], [2521202.688999999780208, 1156186.831], [2521203.436000000219792, 1156187.495000000111759], [2521203.612999999895692, 1156188.035], [2521203.177999999839813, 1156188.791], [2521202.808000000193715, 1156190.041999999899417], [2521202.596, 1156192.982], [2521202.308999999891967, 1156195.659], [2521202.654, 1156196.815], [2521203.208999999798834, 1156198.111], [2521203.773, 1156199.876], [2521204.279999999795109, 1156200.683999999891967], [2521205.219, 1156202.906], [2521205.969, 1156204.011], [2521206.355, 1156205.018], [2521207.106000000145286, 1156205.791999999899417], [2521207.886, 1156206.941000000108033], [2521208.744, 1156207.808], [2521210.592000000178814, 1156208.931], [2521211.298, 1156208.968000000109896], [2521212.804, 1156209.3], [2521213.984000000171363, 1156209.549000000115484], [2521214.619, 1156209.888], [2521215.200999999884516, 1156211.499], [2521216.034, 1156212.163], [2521216.909, 1156213.176], [2521217.265999999828637, 1156214.027], [2521217.742, 1156214.756]]]] } }
  ]
}


var liste_etat = ['Tous', '2022-02-10', '2020-11-24']

class layer_json {
  constructor(color, color_fill, line, width_li, name_layer, geojson_layer, etat) {
    this.color = color;
    this.color_fill = color_fill
    this.line = line;
    this.width_li = width_li;
    this.name_layer = name_layer;
    this.geojson_layer = geojson_layer;
    this.etat = etat;
  }
}

var liste_layer_json = [];


liste_layer_json.push(new layer_json('red', 'rgb(250, 0, 0, 0.4)', 1, 4, "Secteur de cubage", json_secteur_cubage_2022, liste_etat[1]))
liste_layer_json.push(new layer_json('red', 'rgb(250, 0, 0, 0.4)', 1, 4, "Secteur de cubage", json_secteur_cubage_2020, liste_etat[2]))
liste_layer_json.push(new layer_json('rgb(20, 0, 0, 1)', 'rgb(20, 0, 0, 0)', 1, 2, "Casier", json_casier, ''))
liste_layer_json.push(new layer_json('blue', 'rgb(0, 0, 0, 0)', 10, 4, "Périmètre", json_perimetre, ''))

// Liste des layers avec nom
var vector_list = [];
vector_list.push(["Orthophoto", staticimage, liste_etat[1]])
vector_list.push(["Orthophoto", staticimage_2020, liste_etat[2]])
for (let value of liste_layer_json) {
  vector_list.push([value['name_layer'], create_vector(value), value['etat']])
}

// Items for liste des couches
var item_list = [];
for (let value of vector_list) {
  item_list.push({ message: value[0], etat: value[2] })
}


//Création des paramètres de vue (zoom et centre)
// ================================================================================
const view_map = new View({
  center: [2521300, 1156000],
  projection: projection,
  zoom: 13,
  maxZoom: 16
});


export default {
  data: () => {
    return {
      items: item_list,
      etats: liste_etat
    }
  },
  mounted() {
    const map = new Map({
      target: "ol-container",
      view: view_map
    });

    map.addLayer(wmtsCadastre);
    for (let layer_i of vector_list) {
      map.addLayer(layer_i[1]);
    }
  },
  methods: {
    change_visibility(layer_name, etat, event) {
      for (let layer_i of vector_list) {
        update_visibility(layer_name, etat, layer_i[0], layer_i[1], layer_i[2], event.target)
      }
    },
    change_etat(event) {
      let etat_choisi = event.target.value
      console.log(event)
      for (let layer_i of vector_list) {
        update_visibility_etat(etat_choisi, layer_i[1], layer_i[2], etat_choisi)
      }
      let liste_couche = document.getElementsByClassName("layer_line_descr");
      for (let couche of liste_couche) {
        update_display_liste_couche(couche, etat_choisi)
      }
    }
  },
};
</script>

<style scoped>
#inside_view {
  height: calc(100% - 80px);
  display: flex;

}

#ol-container {
  height: 100%;
  width: calc(100% - 400px);
}

#layer_div {
  width: 400px;
}

#layer_list {
  margin: 20px 25px;
}

#layer_title {
  margin-bottom: 20px;
  text-decoration: underline;
  font-weight: 600;
}

.layer_line_descr div {
  text-align: left;
  margin-bottom: 5px;
  cursor: pointer;
  font-weight: 400;
  display: flex;
}

.layer_line_descr div:hover {
  font-style: italic;
  text-decoration: underline;
}

#descr_utile {
  font-size: 15px;
  text-align: left;
  margin-top: 50px;
  font-style: italic;
  font-family: 'Courier New', Courier, monospace;
}

#select_etat {
  text-align: left;
  width: 200px;
}

#div_select_etat {
  text-align: left;
  margin-bottom: 20px;
}
</style>
